# 📋 개발 로그 (Development Log)

이 문서는 아이보틀 프로젝트의 주요 변경사항 및 개발 이력을 기록합니다.

---

### **2025년 6월 28일**

- **MyoCare 근시케어 차트 시스템 완성** 📊
  - **대시보드 구현**:
    - 전체 환자 통계 카드 (총 환자, 고위험, 중위험, 활성 환자)
    - 위험도 분포 도넛 차트
    - 치료방법별 분포 바 차트
    - 최근 방문 환자 목록
  - **환자 관리 시스템**:
    - 환자 CRUD 기능 (생성, 읽기, 수정, 삭제)
    - 실시간 검색 및 필터링
    - 진행상태 위험도 자동 계산 및 표시
    - 신규환자 등록 및 편집 모달
  - **진행 그래프 시각화**:
    - S.E.(구면상당치) 및 안축장 진행 차트
    - 치료구간 배경색 시각화
    - 위험도별 포인트 색상 구분 (정상/주의/위험)
    - 안경처방 여부 👓 아이콘 표시
    - 인쇄 최적화 (A4 2페이지)
  - **검사 기록 관리**:
    - 양안 데이터 입력 (구면, 원주, 안축장)
    - S.E. 자동 계산
    - 진행속도 자동 계산 (D/yr, mm/yr)
    - 검사 기록 인라인 편집/삭제
  - **설정 관리**:
    - 진행 임계값 커스터마이징 (SE/AL별 주의/위험 경고선)
    - 치료방법별 색상 설정
    - EMR 템플릿 변수 선택 시스템
    - 사용자 경과 문구 커스터마이징

- **EMR 복사 기능 구현** 📋
  - **템플릿 시스템**:
    - 동적 변수 선택 (치료방법, S.E., 안축장, 진행속도 등)
    - 실시간 템플릿 미리보기
    - 최신 검사 데이터 자동 채움
  - **복사 기능**:
    - 차트 페이지에 EMR 복사 버튼 추가
    - 클립보드 API 사용 (구형 브라우저 호환)
    - 복사 성공 피드백 UI
  - **안경처방 변수 추가**:
    - `[안경처방]` 변수를 EMR 템플릿에 추가
    - 처방이 있을 때만 "당일 안경처방함" 출력
    - 스마트 조건부 렌더링

- **UI/UX 개선** 🎨
  - **버튼 디자인 향상**:
    - 그라데이션 배경 및 호버 효과
    - 에메랄드색 EMR 복사 버튼으로 시각적 구분
    - 툴팁 추가로 기능 명확화
    - 반응형 디자인 (모바일 최적화)
  - **헤더 개선**:
    - "근시케어 차트" 메인 타이틀 유지
    - "MyoCare Chart" 서브타이틀로 변경
    - 로고 모서리 둥글게 처리 (rounded-xl)
  - **테이블 액션 버튼**:
    - 검사결과 입력 (파란색)
    - 진행 그래프 보기 (에메랄드색)
    - 호버 시 그림자 효과

- **기술적 개선사항** 🔧
  - **TypeScript 타입 안전성**:
    - TreatmentMethod 타입 import 누락 수정
    - null 체크 에러 해결
    - 엄격한 타입 정의 유지
  - **LocalStorage 추상화**:
    - storage.ts를 통한 중앙 관리
    - Supabase 마이그레이션 준비
    - 데모 사용자 자동 생성
  - **성능 최적화**:
    - 큰 데이터셋 처리 최적화
    - 차트 렌더링 성능 개선
    - 불필요한 리렌더링 방지

- **알려진 이슈 (보류)** ⚠️
  - 차트 배경색이 개발 서버에서 표시 안됨
  - 인쇄 시 그래프 선이 나타나지 않음
  - 추후 해결 예정

- **오늘의 성과 요약** 🎯
  - ✅ MyoCare 차트 시스템 MVP 완성
  - ✅ EMR 복사 기능으로 실무 활용성 증대
  - ✅ UI/UX 개선으로 사용성 향상
  - ✅ 안정적인 타입 시스템 구축

### **2025년 1월 2일**

- **Resend 이메일 서비스 구현 완료** 📧
  - **계정 생성 및 설정**:
    - Resend.com에서 계정 생성 완료
    - API 키 발급 (`re_xxxxxxxxx` 형태)
    - Vercel Environment Variables에 `RESEND_API_KEY` 추가
  - **배포 환경 설정**:
    - Vercel Dashboard → Project Settings → Environment Variables
    - `All Environments` 적용으로 개발/프로덕션 통합 관리
    - 재배포 자동 트리거로 즉시 적용
  - **기능 상태**: 이메일 발송 시스템 정상 작동 확인 ✅
  - **향후 활용**: 환자 리포트 이메일 발송, 문의 메일 등에 활용 예정

- **검진결과 인쇄 로고 통합 개선** 🏥
  - **문제**: 기존 회색 원형 플레이스홀더 (`bg-gray-200 rounded-full`)
  - **해결**: 실제 병원 로고 `lee_eye_symbol.png`로 교체
  - **적용 범위**:
    - **HTML 리포트 (3개)**: `comprehensive_exam_report.html`, `diabeticretinopathy_exam_report.html`, `htn_retinopathy_report.html`
    - **PDF 컴포넌트 (3개)**: `DiabeticReportPDF`, `HypertensionReportPDF`, `ComprehensiveReportPDF`
  - **레이아웃 개선**:
    - 로고 크기: 30x30px (PDF), 40x40px (HTML)
    - 배치: 병원 정보 좌측에 정렬
    - `object-contain` 클래스로 비율 유지
  - **결과**: 모든 검진결과 인쇄물에 병원 브랜딩 통일성 확보 ✨

- **눈종합검진 인쇄 중복 문제 해결** 🔧
  - **문제**: 정밀 검사 세부 소견 페이지가 2장으로 중복 인쇄
  - **원인**: `renderComprehensivePreview` 함수에서 2페이지 컨텐츠가 중복 렌더링
    - 첫 번째 블록: 1페이지 + 페이지 브레이크 + 2페이지
    - 두 번째 블록: 2페이지만 다시 중복 생성
  - **해결**: 중복된 `comprehensive-page-2` div 블록 완전 제거
  - **결과**: 이제 눈종합검진이 정확히 2페이지만 인쇄됨 📄📄 → 📄📄

- **개발 문서 업데이트** 📚
  - 오늘 작업 내용을 `DEVELOPMENT_LOG.md`에 기록
  - 이메일 설정 과정을 메모리에 저장하여 향후 재사용성 확보
  - 로고 변경 방법 및 인쇄 문제 해결 과정 문서화

- **눈종합검진 대규모 개선** 🔄
  - **위험도 시스템 전면 개편**:
    - 기존: Low Risk / Moderate Risk / High Risk
    - 변경: 정상 / 경미한 / 중등도 / 심각한
  - **자동연동 시스템 구현**:
    - 위험도 선택 시 주요소견, 종합소견, 추적관찰 기간 자동 입력
    - 직접 수정도 가능한 유연한 시스템
  - **기본검사 UI/UX 개선**:
    - 굴절: 정상/경도 근시/중등도 근시/고도 근시/경도 원시/규칙 난시/불규칙 난시 선택지 추가
    - 외안부: 정상/결막 충혈/안검염/다래끼 선택지 추가
    - 수정체: 투명/경미한 혼탁/백내장 의심 선택지 추가
    - 안저: 정상/망막변성/시신경 창백/출혈 선택지 추가
    - 모든 항목에 '직접입력' 옵션 제공
  - **정밀검사 항목 변경**:
    - 안구건조증 검사 제거
    - 안구 초음파(Sono) 검사 추가
    - 각 검사명에 영문 약어 병기 (Topography, OCT, VF, Sono)
    - 정상/직접입력 2단계 시스템으로 단순화
  - **종합소견 위치 변경**:
    - 기존: 2페이지 하단
    - 변경: 1페이지 요약 바로 아래 (파란색 박스)
  - **위험도별 권고사항 차별화**:
    - 정상: 정기 검진 유지
    - 경미한: 주기적 모니터링
    - 중등도: 적극적 치료 계획
    - 심각한: 즉각적인 치료

- **오늘의 성과 요약** 🎯
  - ✅ 이메일 발송 시스템 완전 구축 (Resend + Vercel)
  - ✅ 검진결과 인쇄물의 브랜딩 통일성 확보
  - ✅ 눈종합검진 인쇄 중복 버그 완전 해결
  - ✅ 눈종합검진 대규모 개선으로 의료 서비스 품질 향상
  - ✅ 개발 기록 및 메모리 업데이트

---

### **2024년 12월 30일**

- **데모영상 버튼 통일성 구축** ✨
  - YouTube 스타일 빨간색 버튼으로 모든 페이지 통일 (`DemoVideoButton` 컴포넌트)
  - 영상 리스트 모달 구현 (검진결과, 근시케어, AI챗봇 각각 URL 설정)
  - 썸네일 16:9 비율 최적화 (480×270) 및 모바일 반응형
  - 자세한 구현 내용은 `docs/DEMO_VIDEO_BUTTON_GUIDE.md` 참조

- **퀵 네비게이션 메뉴 시스템** 🧭
  - 모든 페이지에 햄버거 메뉴 통합 적용 (`QuickNavMenu` 컴포넌트)
  - 10개 주요 기능으로 원클릭 접근
  - 현재 페이지 하이라이트 및 Beta 배지 시스템
  - React Portal 기반 z-index 충돌 해결
  - ESC 키 지원 및 완벽한 이벤트 차단

- **Contact 메일 팝업 기능**
  - About 페이지와 동일한 메일 작성 팝업을 랜딩 페이지에 적용
  - 메일 폼 상태 관리 및 전송 시뮬레이션
  - 팝업 크기 최적화로 가독성 개선

---

### **2024년 12월 29일**

- **홈페이지 내비게이션 오류 해결**
  - `div`로 잘못 만들어져 있던 기능 카드를 `Next.js <Link>` 컴포넌트로 수정
  - Playwright 테스트를 통해 라이브 환경에서의 링크 이동 검증 완료

- **카드 UI 디자인 개선**
  - 기능 카드들의 깨진 레이아웃 복구 및 디자인 통일성 확보
  - '검진결과 작성' 카드에 `NEW!` 배지를 추가하여 시각적 강조

---

### **2024년 12월 26일**

- **검진결과 작성 시스템 구현** ✅
  - 3가지 검진 템플릿 (당뇨망막병증, 고혈압망막병증, 눈종합검진)
  - 좌우 분할 UI (입력 폼 40% + 실시간 미리보기 60%)
  - 브라우저 네이티브 인쇄 기능
  - A4 최적화 레이아웃

---

### **2024년 12월 초**

- **프로젝트 초기 셋업**
  - Next.js 15 + TypeScript + Tailwind CSS 4
  - Shadcn/ui 컴포넌트 라이브러리 통합
  - 글래스모피즘 디자인 시스템 구축

---

## 📌 개발 규칙

1. **커밋 메시지 형식**: `type: description` (feat, fix, docs, style, refactor, test, chore)
2. **브랜치 전략**: main (production) ← develop ← feature/xxx
3. **코드 리뷰**: PR 생성 후 최소 1명 이상 리뷰
4. **테스트**: 주요 기능 변경 시 Playwright 테스트 추가

---

## 🔗 관련 문서

- [프로젝트 히스토리](PROJECT_HISTORY.md) - 전체 이벤트 시간순 기록
- [Claude Code 가이드](CLAUDE_CODE_GUIDE.md) - AI 협업 가이드
- [README](README.md) - 프로젝트 소개 및 설치 가이드