# 📋 개발 로그 (Development Log)

이 문서는 아이보틀 프로젝트의 주요 변경사항 및 개발 이력을 기록합니다.

---

### **2025년 6월 28일**

- **이메일 문의 기능 실제 구현** 📧
  - **Resend 서비스 통합**: 
    - `resend` 패키지 설치 및 API Route 구현
    - `/api/send-email` 엔드포인트 생성
    - 환경변수를 통한 API 키 관리
  - **기능 구현 완료**:
    - 랜딩 페이지 Contact 섹션의 이메일 문의 폼
    - About 페이지의 이메일 문의 폼
    - 실시간 폼 유효성 검사
    - 전송 상태 표시 (로딩, 성공, 실패)
  - **이메일 템플릿**:
    - HTML 형식의 깔끔한 이메일 템플릿
    - 문의자 정보 및 내용 구조화
    - Reply-to 헤더로 직접 답장 가능
  - **문서화**:
    - Resend 설정 가이드 작성 (`docs/RESEND_EMAIL_SETUP_GUIDE.md`)
    - 환경변수 예제 파일 (`.env.local.example`)
    - Vercel 배포 설정 안내 포함

---

### **2025년 12월 30일**

- **About 페이지 개선 프로젝트 완료** 🎯
  - **6단계 체계적 개선**: 데모영상 통일성 → 공통 컴포넌트 → 퀵 네비게이션 메뉴
  - **DemoVideoButton 공통 컴포넌트 생성**: 
    - YouTube 스타일 빨간색 그라데이션
    - Play 아이콘 + 호버 효과
    - 모든 페이지에서 재사용 가능
  - **영상 리스트 모달 구현**: 검진결과, 근시케어, AI챗봇 영상 통합 관리
  - **Contact 섹션 메일 팝업**: About 페이지와 동일한 메일 작성 기능을 랜딩 페이지에 적용

- **퀵 네비게이션 메뉴 시스템 구축** 🧭  
  - **전체 페이지 통합**: 랜딩, 검진결과, 근시케어, About 페이지 모두 적용
  - **햄버거 메뉴 스타일**: 우측에서 슬라이드하는 반응형 메뉴
  - **10개 주요 기능 접근**: 홈, 검진결과, 근시케어 등 원클릭 이동
  - **현재 페이지 하이라이트**: 진한 배경색으로 위치 표시  
  - **Beta 배지 시스템**: 새로운 기능 구분 표시

- **기술적 문제 해결** 🔧
  - **검진결과 페이지 메뉴 문제**: React Portal로 DOM 최상위 렌더링
  - **z-index 충돌 해결**: `z-[9998]`, `z-[9999]` 최상위 값 적용
  - **이벤트 전파 차단**: stopPropagation(), preventDefault() 완벽 적용
  - **ESC 키 지원**: 키보드 접근성 및 스크롤 제어

- **사용자 경험 최적화** ✨
  - **일관된 네비게이션**: 모든 페이지에서 동일한 메뉴 경험  
  - **직관적 접근**: 어디서든 주요 기능으로 빠른 이동
  - **시각적 피드백**: 호버 효과 및 현재 위치 표시
  - **반응형 지원**: 모바일과 데스크톱 완벽 대응

---

### **2025년 6월 23일**

- **베타테스터 신청 기능 완전 제거** 🔧
  - **제거된 기능**: 
    - 메인 페이지의 베타테스터 신청 Dialog 팝업 및 폼
    - 하단 메뉴의 베타테스터 신청 카드 (4개 → 3개로 축소)
    - Notion API 연동 코드 (`actions/notion.ts`, `lib/notion.ts`)
    - 관련 React hooks 및 컴포넌트 import
  
- **UI 균형성 개선** 🎨
  - **카드 높이 균일화**:
    - 모든 기능 카드에 `h-full flex flex-col` 클래스 추가
    - 그리드 컨테이너에 `items-stretch` 클래스 적용
    - 검진결과 작성 카드에 '실시간 미리보기' 항목 추가로 콘텐츠 균형 맞춤
  - **하단 메뉴 개선**:
    - 3개 카드(업데이트 노트, About Me, Contact)로 재구성
    - 동일한 높이 균일화 클래스 적용

- **프로젝트 정리** 📁
  - `.gitignore` 업데이트:
    - VS Code 확장 관련 파일 추가 (`ccusage-vscode-extension/`)
    - 로컬 설정 파일 추가 (`.claude/settings.local.json`)
    - 임시 다운로드 파일 추가 (`packages.microsoft.gpg`, `vscode.tar.gz`)

- **기타 개선사항** ✨
  - 불필요한 import 정리 (useRef, useEffect, useActionState 등)
  - 코드 가독성 향상을 위한 구조 단순화

---

### **2025년 6월 17일**

- **오류 해결 및 환경 안정화** 🔧
  - **문제 진단**: `exam-results` 페이지 접근 시 `Internal Server Error` 및 빈 화면 표시 문제 발생.
  - **원인 파악**: `page.tsx` 파일에 `'use client'` 지시어가 누락되어, 서버 환경에서 브라우저 전용 객체(`window`)에 접근하려다 생긴 렌더링 오류임을 확인.
  - **해결**: 파일 최상단에 `'use client'`를 추가하여 서버 및 클라이언트 렌더링 문제를 완벽히 해결.
  - **포트 확인**: 개발 서버가 `3001`번 포트에서 실행 중인 것을 확인하고, 모든 테스트 URL을 `3001`로 통일.

- **자동화 테스트 환경 구축 (Playwright)** 🤖
  - **설치 및 초기화**: Playwright 관련 패키지를 설치하고, 브라우저 드라이버를 설정하여 테스트 준비 완료.
  - **테스트 케이스 작성**: '인쇄 시 내용 중복' 버그를 재현하고 검증하기 위한 `tests/printing-bug.spec.ts` 테스트 파일 생성.
    - **검증 로직**: 인쇄 모드에서 미리보기 영역에 "환자 정보" 제목이 정확히 **한 번만** 나타나는지 확인 (`toHaveCount(1)`).
  - **버그 재현 성공**: 작성한 테스트를 실행하여 버그가 실제로 존재함을 스크린샷과 함께 명확하게 확인함.

- **오늘의 성과 요약** 🎯
  - ✅ 서버 렌더링 오류를 해결하여 애플리케이션을 정상 작동 상태로 복구.
  - ✅ Playwright를 이용해 까다로운 UI 버그를 자동으로 잡아내는 테스트 환경 구축.
  - ✅ '인쇄 중복' 문제의 원인을 명확히 하고, 해결을 위한 구체적인 테스트 케이스 확보.

- **향후 계획 (내일 첫 작업)** 📋
  - **최우선 과제**: 오늘 Playwright로 확인한 '인쇄 중복' 문제 해결.
    - **해결 전략**: `handlePrint` 함수를 수정하여, 인쇄 시 미리보기 영역만 깨끗하게 복사 후 인쇄하는 '인쇄 전용 복사본' 로직 적용.
  - **검증**: 수정 후 `tests/printing-bug.spec.ts` 테스트를 다시 실행하여 문제가 해결되었는지 최종 확인.

---

### **2024년 6월 16일**

- **문서화**
  - `README.md` 파일에 6개월 단기 목표 및 개발 로드맵을 구체적으로 명시.
  - 핵심 기능 MVP 개발, 파일럿 테스트, 베타 테스트 확장, 개발 역량 확보 계획을 포함하여 프로젝트 방향성을 명확히 함.

---

### **2024년 5월 22일**

- **UI/UX 개선**
  - 메인 타이틀 텍스트가 모바일 및 PC 화면 모두에서 일관된 줄바꿈을 가지도록 수정 (`<br>` 태그 클래스 제거).
  - "데모 영상 보기" 버튼에서 시각적 혼동을 줄 수 있는 화살표 아이콘(→, >) 제거.
  - 모바일 화면에서 문장 끝의 단어 하나만 줄바꿈되는 현상을 방지하기 위해 `break-keep` 클래스 적용.
  - 특정 설명 문구가 항상 한 줄로 표시되도록 `whitespace-nowrap` 클래스 추가.
  - 헤더와 기능 소개 카드 사이의 시각적 균형을 위해 하단 여백(`mb-20`) 추가.
  - 실수로 삭제되었던 "아이보틀 주요 기능" H2 타이틀 복구.
- **문서화**
  - `README.md`의 개발 현황을 최신 상태로 업데이트.

---

### **2025년 6월 15일**

- **기능 추가: 'About Me' 페이지**
  - Claude Code(Opus 모드)를 활용하여 '이동은 안과 전문의' 소개 페이지를 신규 생성.
  - 경로: `src/app/about/page.tsx`
  - 랜딩 페이지의 디자인과 통일성을 유지하며, 반응형으로 구현.
- **라우팅 설정**
  - 랜딩 페이지의 'About Me' 정보 카드를 클릭하면, 새로 생성된 `/about` 페이지로 이동하도록 `<Link>` 컴포넌트로 연결.
- **개발 환경 설정**
  - Windows 환경에서 Claude Code를 사용하기 위해 WSL(Ubuntu) 및 Node.js 설정을 완료하고, 이 과정을 메모리에 기록하여 향후 재사용성 확보.

---

### **2025년 1월 15일**

- **About Me 페이지 디자인 개선**
  - **배경 이미지 적용**: 헤더 섹션에 실제 진료실 사진(`clinic-me.jpg`) 배경 이미지 적용
    - `opacity-30`

### **2025년 6월 16일 (오전)**

- **About Me 페이지 모바일 최적화 완료** ✅
  - **문제 해결**: 모바일에서 '최신 의료장비' 섹션 레이아웃 깨짐 현상 수정
    - 원인: 컨테이너 너비 미지정으로 인한 반응형 레이아웃 오류
    - 해결: `w-full lg:w-2/5` 클래스 추가로 모바일/데스크톱 대응
  - **디자인 개선**: 파스텔 톤 배경색으로 일관성 있는 UI 구현
    - 복잡한 그라데이션 → 부드러운 단색 (`bg-blue-100`, `bg-emerald-100`)
    - 모바일 반응형 높이 및 이미지 크기 최적화
  - **아이콘 업그레이드**: Lucide React 라이브러리 도입으로 전문성 강화
    - 백내장(`Eye`), 녹내장(`Droplets`), 소아안과(`Baby`) 등 의료 관련성 높은 아이콘 적용
  - **텍스트 가독성 향상**: 모바일에서 자연스러운 줄바꿈 구현
    - `<br className="sm:hidden" />` 활용한 반응형 텍스트 처리

- **검진결과 작성 기능 개발 시도** ❌
  - **목표**: DM(당뇨), HTN(고혈압), 눈종검 PDF 생성 기능 구현
  - **실패 원인**: Claude Code와의 협업 과정에서 패키지 의존성 충돌 발생
    - `jsPDF`, `html2canvas` 설치 과정에서 Next.js 패키지 손상
    - Turbopack 크래시 및 SWC 모듈 누락 오류 연쇄 발생
  - **복구 과정**: Git을 통한 완전 복구 및 패키지 매니저 변경
    - `git checkout .` + `git clean -fd`로 변경사항 되돌림
    - pnpm → npm 전환으로 의존성 문제 해결 (439개 패키지 정상 설치)

- **개발 환경 안정화** 🔧
  - **패키지 매니저 정책 변경**: pnpm → npm 전환
    - 이유: 복잡한 의존성에서 npm이 더 안정적임을 확인
    - 메모리 업데이트로 향후 재발 방지
  - **Claude Code 사용 교훈**: 복잡한 패키지 설치 시 신중한 접근 필요
    - 특히 `rm -rf node_modules` 같은 위험한 명령어 주의

- **문서 및 환경 정리** 📚
  - **README.md**: pnpm → npm 명령어로 전면 수정
  - **배치 파일**: `dev-pnpm.bat` → `dev-npm.bat` + 새로운 `dev.bat` 생성
  - **.gitignore**: npm 관련 무시 파일 추가
  - **메모리 업데이트**: 패키지 매니저 정책을 npm 전용으로 변경

- **오늘의 성과 요약** 🎯
  - ✅ About Me 페이지 모바일 완전 최적화
  - ✅ 전문적인 의료 아이콘 및 파스텔 디자인 적용
  - ✅ 패키지 의존성 문제 완전 해결 (npm 전환)
  - ✅ 개발 환경 안정화 및 문서 정리 완료
  - ❌ 검진결과 PDF 기능 (의존성 충돌로 연기)

- **향후 계획** 📋
  - 검진결과 작성 기능은 내일부터 안전한 방법으로 재개발 예정
  - 단계별 접근: UI 먼저 → PDF 기능 나중에 분리 개발
  - npm 환경에서 안정적인 개발 지속

---

### **2025년 6월 16일 (오후)**

- **검진결과 작성 기능 완전 구현** 🎯
  - **새로운 라우트**: `/exam-results` 경로 생성
  - **3가지 검진 템플릿**: 당뇨망막병증, 고혈압망막병증, 눈종합검진
  - **실시간 좌우 분할 UI**: 입력 폼(40%) + 미리보기(60%)
  - **브라우저 네이티브 인쇄**: PDF 라이브러리 없이 안정성 확보

- **당뇨망막병증 지능형 시스템** 🤖
  - **단계별 자동 멘트**: 양안 중 높은 단계 기준으로 요약 및 향후계획 자동 생성
  - **5단계 세분화**: 정상 → 경증 → 중등도 → 중증 → 증식
  - **추적 간격 자동화**: 6개월 → 2~3개월 → 담당의사 권고
  - **실시간 반영**: 안저검사 선택 시 즉시 멘트 변경

- **UI/UX 최적화** ✨
  - **세련된 상단 네비게이션**: 글래스모피즘 + 그라데이션 버튼
  - **반응형 스케일링**: 각 검진별 최적 배율 (0.8 / 0.95)
  - **스크롤 최적화**: 1페이지는 전체 표시, 2페이지는 스크롤 가능
  - **의료 문서 표준화**: 색상 통일, 깔끔한 테이블 구조

- **기술적 성취** 🔧
  - **타입 안전성**: TypeScript로 모든 데이터 구조 정의
  - **상태 관리**: React hooks로 실시간 데이터 동기화
  - **A4 호환성**: 인쇄 시 정확한 레이아웃 보장
  - **메인 페이지 연동**: 기능 카드에서 직접 접근 가능

- **개발 완료 항목** ✅
  - [x] 검진 템플릿 선택 UI
  - [x] 당뇨망막병증 입력 폼 + 미리보기
  - [x] 고혈압망막병증 입력 폼 + 미리보기  
  - [x] 눈종합검진 입력 폼 + 미리보기 (2페이지)
  - [x] 단계별 자동 멘트 시스템
  - [x] 브라우저 인쇄 기능
  - [x] 반응형 레이아웃 최적화

- **인쇄 기능 문제 해결 시도** 🖨️
  - **문제**: 미리보기와 실제 인쇄가 겹쳐서 내용이 두 번 나오는 현상
  - **시도한 해결책**: 
    - 미리보기 컨테이너에 `print-hide` 클래스 추가
    - 별도의 인쇄 전용 컨테이너 생성 (`hidden print:block`)
    - 3가지 검진 모두에 동일한 패턴 적용
  - **결과**: 문제가 완전히 해결되지 않음 → **내일 계속 작업 예정**

---

---

### **2025년 6월 26일**

- **근시케어 시스템 전면 구현** 🚀
  - **환자 관리 페이지** (`/myocare/patients`)
    - 환자 목록 테이블: 이름, 생년월일, 차트번호, 위험도, 마지막 방문일
    - 위험도별 색상 코딩 (빨강: 고위험, 주황: 중간, 초록: 정상)
    - 실시간 검색 기능 (이름, 차트번호)
    - 정렬 기능: 마지막 방문일 기준
    - 편집/삭제 모달 통합
  
  - **환자 상세 차트** (`/myocare/patients/[id]/chart`)
    - SE(구면대응치) 및 안축장 진행 그래프
    - Recharts 라이브러리로 시각화
    - 양안/단안 선택 뷰
    - 진행 속도 계산 (연간 변화율)
    - 검사 이력 테이블 (인라인 편집 가능)
    - 위험도 자동 계산 및 표시
  
  - **새 검사 입력** (`/myocare/patients/[id]/visits/new`)
    - SPH, CYL 입력 → SE 자동 계산
    - 안축장 측정값 입력
    - 치료방법 체크 (안경, 드림렌즈, 마이오가드 등)
    - 안경처방 입력 옵션
    - 이전 치료방법 자동 불러오기

- **공통 컴포넌트 개발** 🧩
  - **DemoVideoButton**: YouTube 스타일 데모 영상 버튼
    - 빨간색 그라데이션 + Play 아이콘
    - 호버 애니메이션 효과
    - 모든 페이지에서 재사용
  
  - **QuickNavMenu**: 주요 기능 네비게이션
    - 우측 슬라이드 메뉴
    - 10개 주요 기능 링크
    - 현재 페이지 하이라이트
    - Beta 배지 시스템

- **PDF 생성 기능 추가** 📄
  - **@react-pdf/renderer** 도입
  - 검진결과 PDF 템플릿 3종:
    - 당뇨망막병증 검사 결과서
    - 고혈압망막병증 검사 결과서  
    - 눈종합검진 결과서
  - 한글 폰트 지원 (NotoSans)
  - A4 사이즈 최적화 레이아웃

- **UI/UX 대폭 개선** ✨
  - **랜딩 페이지**:
    - 이메일 문의 팝업 추가
    - 데모 영상 모달 구현
    - QuickNavMenu 통합
  
  - **검진결과 페이지**:
    - PDF 다운로드 기능
    - 실시간 미리보기
    - 인쇄 기능 개선
  
  - **About 페이지**:
    - Hot Reloading 최적화
    - 모바일 반응형 개선

- **기술 스택 업데이트** 🔧
  - 신규 패키지:
    - `@react-pdf/renderer`: PDF 생성
    - `recharts`: 차트 시각화
    - `date-fns`: 날짜 처리
  - TypeScript 타입 정의 강화
  - 로컬 스토리지 기반 데이터 관리

---

### **2025년 6월 25일**

- **문서 체계 정리 및 PRD 작성** 📚
  - **프로젝트 문서 통합**:
    - CHANGELOG.md + DEPLOYMENT_LOG.md → PROJECT_HISTORY.md로 통합
    - 시간순 이벤트 기록으로 일원화
    - 중복 내용 제거 및 구조 개선
  
- **PRD 체계 구축** 📋
  - **PRD 폴더 생성**: `docs/prd/`
    - PRD 작성 가이드 문서 작성
    - 기존 검진결과 작성 기능 PRD 문서화
    - 근시케어 차트 PRD 초안 작성
  
- **근시케어 차트 기획 전면 개편** 🚀
  - **범위 확대**: 단순 차트 → 종합 환자 관리 시스템
  - **주요 기능**:
    - 대시보드: 전체 환자 통계 및 위험도 분석
    - 환자 관리: CRUD 및 검색 기능
    - 검사 기록: 다중 방문 데이터 관리
    - 보고서: 차트, EMR 복사, 인쇄, Excel
    - 설정: 병원 정보, 임계값, 템플릿 관리
  
- **데이터베이스 설계** 🗄️
  - **Supabase 기반 설계**:
    - 5개 핵심 테이블 구조 설계
    - Row Level Security 정책 수립
    - 인덱스 및 성능 최적화 고려
  - **통합 인증 시스템**: 아이보틀 전체 로그인 연동
  - **의료진별 데이터 완전 분리**
  
- **개발 계획 수립** 📅
  - **총 4-5주 일정**:
    - Phase 0: 기반 구축 (3일)
    - Phase 1: 핵심 기능 (1주)
    - Phase 2: 분석 기능 (1주)
    - Phase 3: 부가 기능 (1주)
    - Phase 4: 마무리 (3일)
  - **각 단계별 데모 포인트 설정**

- **기술적 결정사항** 🔧
  - **Frontend**: Next.js 15 + React 19 + TypeScript 5
  - **차트**: Recharts 라이브러리 선정
  - **Backend**: Supabase (PostgreSQL + Auth + Storage)
  - **MCP**: Supabase MCP 도구 활용 예정

- **문서 파일 정리** 📁
  - 구 파일 삭제: CHANGELOG.md, DEPLOYMENT_LOG.md
  - 신규 생성: PROJECT_HISTORY.md, docs/prd/ 구조
  - README.md 업데이트: 베타테스터 관련 내용 제거